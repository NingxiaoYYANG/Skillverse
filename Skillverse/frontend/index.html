<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Skillverse front-end</title>
        <!-- <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <!-- Include web3.js here -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.1/web3.min.js"
            integrity="sha512-GKw4QT/RccGJIwQxY3MhyiQ5pHrhQ8SuKFEafV+WcpOvtz7iYFQuQGFCvmGlHLctJTe8KrWU1FqvF7VOkEAJtw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <!-- Include abi.js here-->
        <script language="javascript" type="text/javascript" src="abi.js"></script>


        <!-- <div id="monsters"></div> -->

        <!-- CSS STYLES -->
        <link rel="stylesheet" href="index.css" />
        <title>Web3 Login</title>
        </head>
        <body>

            <!-- LOGIN SECTION -->
            <section class="login-section">
            <button class="login-btn">ğŸ”“ Log in with Web3</button>
            <span class="instruction">
                Ensure to have an Ethereum based wallet installed i.e MetaMask
            </span>
            </section>

            <!-- DASHBOARD SECTION -->
            <section class="dashboard-section">
            <h2 class="wallet-status">Wallet Connected! ğŸ¤</h2>
            <h3 class="wallet-address-heading">
                ETH Wallet Address:
                <span class="wallet-address"></span>
            </h3>
            <h3 class="wallet-balance-heading">
            ETH Balance:
                <span class="wallet-balance"></span>
            </h3>
            <button class="logout-btn">ğŸ” Log out</button>
            </section>
        </body>

        <!-- SCRIPT -->
        <script src="./index.js"></script>
        <!-- <script>
            var monsters;
            var userAccount;
            function startApp() {
                var monstersAddress = "0xd9145CCE52D386f254917e481eB44e9943F39138";
                monsters = new web3js.eth.Contract(monstersABI, monstersAddress);
                var accountInterval = setInterval(function() {
                // æ£€æŸ¥è´¦æˆ·æ˜¯å¦åˆ‡æ¢
                if (web3.eth.accounts[0] !== userAccount) {
                    userAccount = web3.eth.accounts[0];
                    // è°ƒç”¨ä¸€äº›æ–¹æ³•æ¥æ›´æ–°ç•Œé¢
                    getMonstersByOwner(userAccount)
                    .then(displayMonsters);
                }
                }, 100);
            }

            var web3Infura = new Web3(new Web3.providers.WebsocketProvider("wss://mainnet.infura.io/ws"));
            var czEvents = new web3Infura.eth.Contract(monstersABI, monstersAddress);
        
            czEvents.events.Transfer({ filter: { _to: userAccount } })
            .on("data", function(event) {
            let data = event.returnValues;
            getMonstersByOwner(userAccount).then(displayMonsters);
            }).on('error', console.error);

            function displayMonsters(ids) {
                $("#monsters").empty();
                for (id of ids) {

                getMonsterDetails(id)
                .then(function(monster) {
                    $("#monsters").append(`<div class="monster">
                    <ul>
                        <li>Name: ${monster.name}</li>
                        <li>Level: ${monster.level}</li>
                        <li>Skills: ${monster.skills}</li>
                    </ul>
                    </div>`);
                });
                }
            }

            function createMonster(name) {
            // è¿™å°†éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥åœ¨ç•Œé¢ä¸­å‘Šè¯‰ç”¨æˆ·è¿™ä¸€ç‚¹
            // äº‹åŠ¡è¢«å‘é€å‡ºå»äº†
            $("#txStatus").text("Creating Monster, Please wait a moment...");
            // æŠŠäº‹åŠ¡å‘é€åˆ°æˆ‘ä»¬çš„åˆçº¦:
            return monsters.methods.createMonster(name)
            .send({ from: userAccount })
            .on("receipt", function(receipt) {
                $("#txStatus").text("sucess generated " + name + "!");
                // äº‹åŠ¡è¢«åŒºå—é“¾æ¥å—äº†ï¼Œé‡æ–°æ¸²æŸ“ç•Œé¢
                getMonstersByOwner(userAccount).then(displayMonsters);
            })
            .on("error", function(error) {
                // å‘Šè¯‰ç”¨æˆ·åˆçº¦å¤±è´¥äº†
                $("#txStatus").text(error);
            });
            }

            // æŸ¥çœ‹monsterçš„id
            function getMonsterDetails(id) {
                return monsters.methods.monsters(id).call()
            }

            // callåˆçº¦ç”¨æˆ·çš„monsterToOwner
            function monsterToOwner(id){
                return monsters.methods.monsterToOwner(id).call()
            }

            // callåˆçº¦ç”¨æˆ·çš„address
            function getMonstersByOwner(owner) {
                return monsters.methods.getMonstersByOwner(owner).call()
            }

            window.addEventListener('load', function(){

                // æ£€æŸ¥web3æ˜¯å¦å·²ç»æ³¨å…¥åˆ°MetaMask
                if (typeof web3 !== 'undefined'){
                    // ä½¿ç”¨MetaMaskçš„æä¾›è€…
                    web3js = new Web3(web3.currentProvider);
                } else {
                    alert("Please install MetaMask first")
                }

                startAPP()
                
            })
        </script> -->
</html>